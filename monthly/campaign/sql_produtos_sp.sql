USE bkp_db_uc_kami;
SELECT
nf.cod_empresa AS empresa,
nfitem.cod_nota_fiscal AS cod_interno,
year(nf.dt_emissao) AS ANO ,
month(nf.dt_emissao) AS Mes,
DATE_FORMAT(nf.dt_emissao,'%Y/%m/%d') AS data_completa,
nf.cod_cliente AS cod_cliente,
nf.razao_social AS razao_social,
cliente.cod_colaborador,
vendedor.nome_colaborador,
nfitem.cod_produto  AS cod_produto,
nfitem.desc_nota_fiscal AS nome_produto, 
item.cod_grupo_produto AS cod_grupo, 
grupo.desc_abrev AS nome_grupo, 
grupo.cod_grupo_pai AS cod_grupo_pai, 
grupop.desc_abrev AS nome_grupo_pai,
nf.nop AS nop,
nfitem.qtd AS qtd,
(CASE WHEN nf.nop IN ("6.102","6.404","BLACKFRIDAY","TRUSS LOVER","VENDA","VENDA_S_ESTOQUE","WORKSHOP") THEN "VENDA" ELSE "BONIFICADO" END) Tipo_Venda,
 (CASE WHEN nf.nop IN ("6.102","6.404","BLACKFRIDAY","TRUSS LOVER","VENDA","VENDA_S_ESTOQUE","WORKSHOP") THEN "1" ELSE "2" END) codigo_Venda,
DATE_FORMAT(cliente.dt_implant,'%Y/%m/%d')
FROM

vd_nota_fiscal_item AS nfitem
LEFT JOIN vd_nota_fiscal AS nf ON (nfitem.cod_nota_fiscal = nf.cod_nota_fiscal)
LEFT JOIN cd_cliente AS cliente ON (cliente.cod_cliente = nf.cod_cliente AND  cliente.cod_colaborador IN (9,15,45,23,57,31,54,66,89,24,231,352,353) )
LEFT JOIN cd_grupo_item AS item ON (nfitem.cod_produto = item.cod_produto)
LEFT JOIN cd_grupo_produto AS grupo ON (grupo.cod_grupo_produto = item.cod_grupo_produto)
LEFT JOIN cd_grupo_produto AS grupop ON (grupop.cod_grupo_produto = grupo.cod_grupo_pai)
LEFT JOIN sg_colaborador AS vendedor ON (cliente.cod_colaborador = vendedor.cod_colaborador)

WHERE 
nfitem.cod_produto in ("574-2","MAT001","MAT002","5755")
and nf.nop in ("CAMPANHA","BONIFICADO", "BONIFICADO_F","BONI_COMPRA")
AND nfitem.cod_empresa IN (1,3)
AND nf.situacao < 100
and nf.dt_emissao > "2021-01-01" 
AND nf.cod_cliente  IN (2,4,7,11,17,18,20,21,29,30,37,38,39,41,44,46,48,57,58,59,62,71,72,74,75,79,80,82,83,87,96,98,99,101,102,105,108,111,116,117,118,120,124,125,126,128,134,139,141,144,148,155,160,162,166,167,168,174,177,178,181,182,191,198,202,203,204,205,209,216,220,221,222,223,226,228,230,231,238,240,242,245,246,249,251,253,254,260,262,263,265,267,268,270,272,273,279,282,283,285,292,293,294,295,299,305,306,307,310,312,318,321,322,323,330,337,338,339,349,352,358,359,362,365,369,370,380,381,382,384,387,388,391,392,393,396,398,399,402,404,405,415,417,420,421,425,431,436,440,443,446,448,449,452,453,457,460,462,463,464,466,470,473,474,475,476,480,482,483,486,488,492,496,497,499,501,502,504,505,507,508,510,511,513,514,516,517,518,519,524,526,531,532,533,534,536,537,538,539,540,542,544,546,548,549,550,551,558,560,562,571,577,580,583,587,589,592,594,598,602,605,606,608,609,615,618,620,621,622,623,626,627,631,635,638,640,641,645,648,651,653,656,657,658,667,670,671,673,675,680,682,683,684,687,689,690,692,693,694,695,698,701,706,710,712,713,714,716,718,722,723,725,726,727,729,731,733,736,737,738,741,742,746,750,753,756,764,768,769,770,772,773,775,777,779,782,784,785,791,792,794,796,797,798,799,800,802,803,806,807,809,810,812,814,815,818,819,828,829,831,832,834,835,836,842,847,849,854,855,857,859,861,865,869,873,874,880,884,885,887,890,892,894,896,897,898,902,903,905,911,913,919,920,923,925,927,935,936,938,943,944,945,946,950,951,952,953,956,958,960,966,969,999,1000,1001,1009,1013,1014,1016,1017,1018,1020,1021,1023,1024,1026,1028,1037,1040,1043,1045,1051,1053,1054,1056,1057,1059,1061,1062,1076,1101,1106,1108,1109,1113,1114,1117,1119,1121,1122,1123,1124,1125,1129,1130,1131,1132,1133,1135,1137,1139,1142,1144,1145,1150,1158,1159,1161,1162,1163,1164,1172,1173,1175,1176,1178,1180,1185,1190,1193,1194,1196,1200,1201,1202,1203,1208,1211,1214,1216,1220,1221,1226,1229,1232,1238,1242,1244,1250,1252,1254,1255,1256,1258,1260,1264,1265,1268,1269,1271,1273,1275,1278,1281,1282,1283,1284,1286,1287,1288,1291,1292,1297,1298,1302,1303,1304,1305,1306,1309,1310,1311,1312,1313,1315,1317,1318,1320,1322,1323,1324,1325,1327,1328,1341,1348,1350,1351,1352,1353,1354,1355,1357,1360,1361,1364,1366,1372,1373,1381,1387,1388,1389,1390,1391,1394,1395,1403,1407,1409,1414,1416,1418,1424,1425,1426,1428,1431,1434,1437,1439,1441,1445,1471,1487,1488,1489,1490,1491,1492,1493,1494,1498,1499,1500,1502,1504,1508,1523,1524,1527,1528,1529,1535,1548,1551,1554,1561,1562,1563,1564,1568,1569,1571,1572,1573,1574,1576,1579,1581,1584,1585,1586,1588,1589,1590,1594,1596,1597,1598,1601,1602,1603,1605,1607,1609,1615,1617,1620,1621,1625,1627,1630,1633,1634,1635,1636,1639,1642,1643,1646,1647,1648,1650,1651,1652,1653,1654,1655,1656,1660,1663,1666,1668,1669,1672,1673,1674,1675,1676,1683,1684,1685,1686,1687,1689,1691,1692,1696,1697,1698,1699,1704,1705,1706,1709,1710,1711,1712,1714,1715,1717,1718,1721,1723,1737,1739,1743,1744,1746,1747,1749,1750,1752,1753,1754,1757,1758,1759,1760,1762,1763,1764,1765,1766,1769,1770,1771,1779,1781,1783,1784,1787,1803,1809,1818,1819,1822,1825,1826,1827,1829,1831,1834,1839,1840,1849,1850,1853,1854,1855,1862,1863,1865,1866,1867,1868,1869,1871,1873,1874,1875,1876,1878,1880,1881,1884,1885,1886,1887,1891,1892,1895,1897,1898,1900,1902,1903,1904,1905,1906,1907,1908,1909,1910,1912,1918,1919,1922,1923,1924,1926,1928,1930,1931,1932,1934,1936,1937,1938,1939,1940,1944,1946,1952,1956,1959,1960,1967,1968,1973,1975,1976,1977,1978,1979,1980,1983,1985,1989,1990,1993,1994,1995,1996,1998,2000,2003,2004,2007,2008,2009,2011,2012,2013,2015,2016,2017,2018,2019,2025,2026,2027,2028,2031,2033,2034,2035,2036,2042,2044,2049,2050,2051,2052,2053,2055,2059,2061,2065,2066,2067,2068,2069,2071,2072,2077,2078,2080,2082,2084,2086,2097,2098,2105,2108,2110,2113,2114,3151,3391,3549,4105,4484,5500,5934,6222,6350,6647,6701,6927,7117,7200,7275,7312,7320,7571,7612,7684,7816,7917,8144,8835,9074,9303,9382,9692,9745,9923,9932,10009,10831,10896,10940,10941,11325,11475,11718,12365,13729,13980,14012,14014,14020,14022,14023,14033,14038,14039,14043,14062,14073,14074,14091,14094,14099,14106,14116,14117,14119,14127,14130,14132,14136,14137,14138,14143,14144,14145,14146,14148,14156,14158,14159,14165,14168,14176,14178,14182,14186,14191,14200,14202,14203,14208,14209,14210,14211,14213,14214,14216,14219,14224,14225,14226,14228,14230,14236,14237,14244,14246,14250,14254,14261,14265,14272,14273,14283,14284,14285,14292,14294,14295,14297,14298,14299,14303,14304,14305,14309,14312,14315,14316,14317,14321,14323,14325,14334,14337,14340,14341,14342,14345,14346,14347,14349,14355,14356,14358,14359,14360,14364,14370,14372,14373,14375,14376,14382,14384,14385,14388,14391,14394,14395,14397,14400,14401,14402,14409,14414,14415,14416,14418,14423,14424,14433,14434,14436,14440,14441,14442,14444,14447,14448,14454,14457,14459,14460,14461,14462,14464,14465,14467,14468,14470,14471,14483,14484,14485,14489,14490,14492,14493,14496,14498,14500,14501,14506,14508,14512,14513,14514,14515,14521,14524,14525,14531,14533,14534,14535,14536,14537,14538,14539,14541,14542,14543,14544,14546,14547,14548,14549,14550,14551,14552,14556,14557,14562,14563,14564,14566,14567,14568,14569,14570,14573,14574,14575,14576,14577,14580,14584,14585,14586,14587,14588,14589,14596,14597,14601,14602,14604,14608,14610,14611,14622,14625,14627,14628,14631,14632,14634,14636,14637,14638,14643,14644,14646,14649,14651,14653,14654,14657,14658,14659,14661,14663,14665,14670,14672,14676,14677,14680,14690,14691,14692,14693,14694,14698,14699,14701,14707,14708,14709,14713,14714,14715,14716,14717,14721,14722,14727,14728,14730,14733,14738,14739,14743,14744,14745,14746,14752,14753,14759,14760,14761,14762,14764,14765,14766,14767,14768,14770,14772,14773,14775,14779,14781,14782,14783,14786,14787,14790,14792,14793,14794,14796,14797,14798,14799,14806,14808,14809,14815,14819,14820,14821,14824,14827,14835,14839,14840,14841,14843,14846,14850,14851,14853,14856,14860,14861,14865,14870,14873,14876,14877,14879,14882,14885,14887,14891,14892,14894,14896,14900,14901,14903,14905,14908,14909,14910,14918,14919,14921,14924,14926,14927,14929,14931,14932,14933,14936,14941,14943,14944,14945,14946,14947,14949,14950,14951,14953,14956,14962,14963,14964,14967,14971,14975,14977,14978,14979,14984,14988,14990,14992,14993,14995,14999,15005,15007,15013,15014,15016,15017,15045,15046,15056,15057,15061,15062,15063,15066,15067,15071,15077,15078,15080,15090,15094,15095,15100,15102,15103,15104,15106,15107,15108,15119,15124,15131,15132,15136,15145,15146,15148,15157,15158,15159,15163,15164,15165,15171,15173,15176,15178,15179,15181,15182,15183,15187,15188,15190,15195,15197,15198,15202,15203,15205,15212,15213,15219,15220,15224,15225,15230,15231,15233,15234,15235,15237,15239,15241,15252,15257,15259,15260,15261,15262,15264,15267,15269,15272,15273,15274,15275,15277,15278,15279,15286,15287,15288,15289,15290,15293,15294,15295,15296,15297,15302,15304,15305,15306,15309,15312,15313,15320,15321,15322,15325,15329,15330,15333,15337,15342,15343,15344,15346,15348,15350,15351,15352,15357,15359,15360,15364,15365,15366,15367,15370,15371,15372,15373,15374,15375,15376,15377,15384,15385,15389,15392,15393,15396,15398,15406,15409,15410,15413,16048,17008,17010,17011,17029,17030,17032,17039,17041,17047,17049,17053,17054,17057,17058,17060,17064,17065,17068,17069,17070,17071,17072,17073,17075,17077,17092,17097,17105,17108,17110,17121,17150,17162,17164,17169,17170,17177,17178,17180,17185,17186,17190,17193,17196,17198,17203,17206,17207,17208,17211,17212,17213,17217,17219,17220,17221,17223,17224,17225,17226,17229,17233,17234,17242,17244,17246,17248,17251,17254,17256,17257,17258,17261,17262,17264,17276,17282,17284,17285,17286,17287,17288,17289,17290,17291,17292,17294,17295,17296,17297,17300,17301,17304,17312,17317,17318,17325,17326,17332,17333,17334,17335,17338,17339,17342,17343,17346,17347,17348,17353,17357,17358,17359,17360,17362,17366,17367,17371,17375,17378,17382,17383,17384,17386,17388,17390,17391,17392,17393,17394,17397,17406,17407,17408,17410,17411,17418,17420,17421,17427,17430,17431,17432,17433,17436,17437,17439,17441,17442,17443,17444,17449,17452,17454,17455,17456,17457,17458,17593,17594,17595,17629,17640,17647,17650,17651,17655,17656,17657,17660,17661,17662,17669,17670,17671,17682,17683,17689,17690,17691,17694,17695,17700,17704,17709,17710,17711,17715,17717,17719,17723,17724,18520,18521,18522,18524,18525,18529,18530,18531,18534,18537,18538,18539,18541,18543,18545,18546,18547,18548,18550,18553,18554,18559,19105,19221,19228,19236,19277,19306,19863,19866,20059,20082,20118,20125,20173,20211,20949,21050,21093,21133,21134,21141,21376,21472,21535,21536,21636,21644,21670,21841,21869,22157,22224,22227,22234,22357,22371,22384,22448,22516,22517,22551,22919,23294,23454,23592,23596,23600,23648,23656,23657,23661,23662,23770,23780,23967,24017,24020,24021,24023,24031,24033,24045,24124,24130,24139,24141,24153,24156,24168,24219,24220,24222,24224,24229,24231,24232,24234,24487,24610,24617,24632,24643,24793,24815,24888,24913,25083,25086,25096,25129,25135,25138,25166,25216,25297,25389,25558,25610,25623,25700,25940,25977,25994,26103,26211,26372,26899,26941,26943,26944,27584,27614,28004,28221,28289,28293,28305,28365,28451,28474,28502,29079,29088,29104,29243,29290,29320,29536,29708,29731,29864,29885,29889,29967,30007,30247,30299,30389,30393,30397,30640,30662,30671,30677,30706,31089,31108,31197,31337,31536,31564,31582,31584,31798,31836,31913,32062,32141,32148,32314,32316,32530,32585,32807,32839,32871,32876,32900,33455,33509,33540,33547,33697,33766,33768,33971,33976,34008,34184,34186,34197,34199,34202,34211,34238,34251,34379,34392,34480,34490,34493,34494,34507,34515,34525,34598,34601,34602,34603,34604,34606,34608,34619,34622,34623,34624,34625,34626,34628,34629,34630,34635,34637,34638,34639,34640,34647,34648,34649,34650,34652,34653,34657,34662,34663,34664,34665,34669,34670,34672,34673,34674,34675,34677,34678,34679,34683)

INTO OUTFILE 'csv/produtos_sp.csv'
CHARACTER SET utf8
FIELDS TERMINATED BY ';'
ENCLOSED BY '"'
LINES TERMINATED BY '\n'




