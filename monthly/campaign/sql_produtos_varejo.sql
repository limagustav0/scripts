USE bkp_db_uc_kami;

select
nf.cod_empresa AS empresa,
nfitem.cod_nota_fiscal as cod_interno,
year(nf.dt_emissao) as ANO ,
month(nf.dt_emissao) as Mes,
DATE_FORMAT(nf.dt_emissao,'%d/%m/%Y') as data_completa,
nf.cod_cliente as cod_cliente,
nf.razao_social as razao_social,
cliente.cod_colaborador,
vendedor.nome_colaborador,
nfitem.cod_produto  as cod_produto,
nfitem.desc_nota_fiscal as nome_produto, 
item.cod_grupo_produto as cod_grupo, 
grupo.desc_abrev as nome_grupo, 
grupo.cod_grupo_pai as cod_grupo_pai, 
grupop.desc_abrev as nome_grupo_pai,
nf.nop as nop,
nfitem.qtd as qtd,
(case when nf.nop in ("6.102","6.404","BLACKFRIDAY","TRUSS LOVER","VENDA","VENDA_S_ESTOQUE","WORKSHOP") then "VENDA" else "BONIFICADO" end) Tipo_Venda,
 (case when nf.nop in ("6.102","6.404","BLACKFRIDAY","TRUSS LOVER","VENDA","VENDA_S_ESTOQUE","WORKSHOP") then "1" else "2" end) codigo_Tipo_Venda,
 (case when nfitem.desc_nota_fiscal like ("USO OBRIGATORIO - RECONSTRUTOR CAPILAR 260ML%") then "USO_TRADICIONAL" 
  when nfitem.desc_nota_fiscal like ("%Net%")  then "NET_MASK" 
  when nfitem.desc_nota_fiscal like ("%night%")  then "NIGHT_SPA" 
 when nfitem.desc_nota_fiscal like ("%hair protector%")  then "HAIR_PROTECTOR" 
 when nfitem.desc_nota_fiscal like ("%MIRACLE MASK COND%")  then "MIRACLE_MASK" 
 when nfitem.desc_nota_fiscal like ("%SPECIFIC MASK%")  then "SPECIFIC_MASK" 
 when nfitem.desc_nota_fiscal like ("%SHAMPOO EQUILIBRIUM%")  then "SHAMPOO_EQUILIBRIUM" 
 when nfitem.desc_nota_fiscal like ("%CONDICIONADOR EQUILIBRIUM%")  then "CONDICIONADOR_EQUILIBRIUM"
 when nfitem.desc_nota_fiscal like ("%SHAMPOO INFUSION 300ML%")  then "SHAMPOO_INFUSION" 
 when nfitem.desc_nota_fiscal like ("%CONDICIONADOR INFUSION 300ML%")  then "CONDICIONADOR_INFUSION" 
 when nfitem.desc_nota_fiscal like ("%SHAMPOO ULTRA HYDRATION 300ML")  then "SHAMPOO_ULTRA_HYDRATION" 
 when nfitem.desc_nota_fiscal like ("%CONDICIONADOR ULTRA HYDRATION 300ML")  then "CONDICIONADOR_ULTRA_HYDRATION" 
  when nfitem.desc_nota_fiscal like ("%SHAMPOO ULTRA HYDRATION PLUS%")  then "SHAMPOO_ULTRA_HYDRATION_PLUS" 
 when nfitem.desc_nota_fiscal like ("%CONDICIONADOR ULTRA HYDRATION PLUS%")  then "CONDICIONADOR_ULTRA_HYDRATION_PLUS" 
   when nfitem.desc_nota_fiscal like ("%SHAMPOO MIRACLE TRUSS%")  then "SHAMPOO_MIRACLE" 
 when nfitem.desc_nota_fiscal like ("%CONDICIONADOR MIRACLE TRUSS%%")  then "CONDICIONADOR_MIRACLE_TRUSS" 
 else "0" end) tipo_produto
 

from

vd_nota_fiscal_item as nfitem
left join vd_pedido_item as pditem on (pditem.cod_pedido = nfitem.cod_pedido and pditem.cod_produto = nfitem.cod_produto)
left join vd_nota_fiscal as nf on (nfitem.cod_nota_fiscal = nf.cod_nota_fiscal)
left join cd_cliente as cliente on (cliente.cod_cliente = nf.cod_cliente and  cliente.cod_colaborador in (6,14,17,27,43,53,58,63,77,78,153,171,215,222,251))
left join cd_grupo_item as item on (nfitem.cod_produto = item.cod_produto)
left join cd_grupo_produto as grupo on (grupo.cod_grupo_produto = item.cod_grupo_produto)
left join cd_grupo_produto as grupop on (grupop.cod_grupo_produto = grupo.cod_grupo_pai)
left join sg_colaborador as vendedor on (cliente.cod_colaborador = vendedor.cod_colaborador)


where 
nfitem.cod_produto in ("574-2","MAT001","MAT002","5755")
and nf.nop in ("CAMPANHA","BONIFICADO", "BONIFICADO_F","BONI_COMPRA")
and nfitem.cod_empresa in (1,3)
and nf.situacao < 100
and nf.dt_emissao > "2021-01-01" 
and nf.cod_cliente  in (2,8,10,16,22,26,28,31,33,40,51,73,84,93,95,97,121,131,135,150,152,153,154,159,163,164,173,174,175,176,188,189,215,230,255,256,277,284,290,291,296,298,300,301,314,315,334,350,367,373,374,375,378,385,389,403,418,428,429,430,437,456,465,493,498,500,520,528,535,537,542,543,565,575,584,585,591,604,607,616,619,621,633,637,653,659,676,685,703,717,719,730,732,734,739,754,757,758,760,761,763,766,778,789,804,817,822,824,825,827,840,863,864,868,912,918,926,930,934,938,962,968,970,971,972,973,974,975,976,977,978,979,980,981,982,983,986,987,988,989,991,992,993,994,995,996,997,998,1016,1027,1030,1041,1047,1048,1049,1050,1069,1072,1073,1075,1077,1078,1079,1080,1081,1082,1083,1084,1085,1086,1087,1088,1089,1090,1091,1092,1094,1095,1096,1110,1112,1118,1119,1125,1127,1140,1156,1157,1169,1171,1173,1181,1198,1199,1206,1207,1228,1230,1231,1237,1241,1243,1249,1276,1277,1314,1322,1334,1336,1362,1363,1371,1374,1393,1401,1402,1410,1436,1442,1443,1444,1446,1447,1500,1503,1514,1515,1538,1547,1552,1556,1578,1580,1583,1591,1610,1612,1614,1619,1622,1631,1632,1640,1644,1645,1657,1658,1659,1661,1690,1694,1698,1702,1703,1713,1716,1719,1720,1727,1745,1748,1761,1767,1816,1817,1842,1843,1856,1857,1859,1876,1888,1896,1898,1899,1913,1914,1921,1922,1925,1933,1941,1951,1965,1969,1991,1992,1999,2001,2002,2006,2009,2022,2045,2070,2090,2095,2124,2574,3391,3852,4096,5934,6217,6222,7704,8119,8144,8151,8305,8352,8405,8543,8590,8768,8842,9001,9383,9724,11043,11266,11877,12489,13150,13452,13777,13879,13946,14011,14026,14039,14115,14130,14200,14257,14261,14281,14300,14301,14302,14306,14310,14313,14334,14336,14357,14383,14418,14419,14423,14424,14427,14439,14478,14479,14480,14481,14482,14499,14517,14530,14534,14535,14553,14572,14599,14600,14621,14656,14686,14710,14711,14729,14735,14740,14741,14751,14754,14780,14789,14823,14837,14838,14849,14852,14855,14859,14868,14869,14871,14872,14949,14957,14988,14991,15002,15004,15010,15012,15050,15051,15052,15053,15074,15083,15088,15089,15110,15138,15162,15164,15192,15193,15199,15201,15210,15240,15242,15251,15263,15267,15280,15281,15300,15320,15324,15336,15339,15347,15394,15401,16033,17009,17012,17015,17017,17023,17028,17032,17033,17045,17046,17049,17052,17056,17104,17156,17163,17165,17171,17184,17204,17205,17210,17231,17236,17240,17247,17255,17302,17320,17321,17322,17323,17329,17334,17349,17350,17351,17352,17354,17355,17364,17367,17374,17376,17404,17412,17425,17446,17452,17454,17592,17596,17628,17633,17634,17635,17645,17650,17679,17680,17696,17697,17699,17713,17721,17722,18456,18457,18458,18459,18460,18461,18462,18463,18464,18465,18466,18467,18468,18469,18470,18471,18472,18502,18515,18517,18518,18543,19199,20135,21048,21383,21867,22119,22435,22448,22508,22509,22510,22579,22580,22581,22582,22583,22584,22585,22934,23441,23473,23923,24033,24219,24220,24222,24224,24229,24231,24232,24234,24492,24517,24632,24699,24762,24770,24771,24912,24923,24940,25059,25103,25104,25127,25173,26154,26246,26248,26372,28462,28502,28985,29062,29188,29345,29888,29889,29993,30971,30976,30977,31381,31383,31585,32105,32148,32316,32873,32910,33013,33110,33495,33509,33972,33975,34197,34246,34251,34420,34488,34605,34610,34615)


INTO OUTFILE 'csv/produtos_varejo.csv'
CHARACTER SET utf8
FIELDS TERMINATED BY ';'
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
